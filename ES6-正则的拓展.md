# æ­£åˆ™çš„æ‰©å±•

1. [RegExpæ„é€ å‡½æ•°](https://github.com/LbhFront-end/About-ES6/blob/master/ES6-æ­£åˆ™çš„æ‰©å±•.md#regexpæ„é€ å‡½æ•°)
2. [å­—ç¬¦ä¸²çš„æ­£åˆ™æ–¹æ³•](https://github.com/LbhFront-end/About-ES6/blob/master/ES6-æ­£åˆ™çš„æ‰©å±•.md#å­—ç¬¦ä¸²çš„æ­£åˆ™æ–¹æ³•)
3. [uä¿®é¥°ç¬¦](https://github.com/LbhFront-end/About-ES6/blob/master/ES6-æ­£åˆ™çš„æ‰©å±•.md#uä¿®é¥°ç¬¦)
4. [RegExp.prototype.unicodeå±æ€§](https://github.com/LbhFront-end/About-ES6/blob/master/ES6-æ­£åˆ™çš„æ‰©å±•.md#regexpprototypeunicodeå±æ€§)
5. [yä¿®é¥°ç¬¦](https://github.com/LbhFront-end/About-ES6/blob/master/ES6-æ­£åˆ™çš„æ‰©å±•.md#yä¿®é¥°ç¬¦)
6. [RegExp.prototype.stickyå±æ€§](https://github.com/LbhFront-end/About-ES6/blob/master/ES6-æ­£åˆ™çš„æ‰©å±•.md#regexpprototypestickyå±æ€§)
7. [RegExp.prototype.flagså±æ€§](https://github.com/LbhFront-end/About-ES6/blob/master/ES6-æ­£åˆ™çš„æ‰©å±•.md#regexpprototypeflagså±æ€§)
8. [sä¿®é¥°ç¬¦:dotAllæ¨¡å¼](https://github.com/LbhFront-end/About-ES6/blob/master/ES6-æ­£åˆ™çš„æ‰©å±•.md#sä¿®é¥°ç¬¦dotallæ¨¡å¼)
9. [åè¡Œæ–­è¨€](https://github.com/LbhFront-end/About-ES6/blob/master/ES6-æ­£åˆ™çš„æ‰©å±•.md#åè¡Œæ–­è¨€)
10. [Unicodeå±æ€§ç±»](https://github.com/LbhFront-end/About-ES6/blob/master/ES6-æ­£åˆ™çš„æ‰©å±•.md#unicodeå±æ€§ç±»)
11. [å…·åç»„åŒ¹é…](https://github.com/LbhFront-end/About-ES6/blob/master/ES6-æ­£åˆ™çš„æ‰©å±•.md#å…·åç»„åŒ¹é…)
12. [String.prototype.matchAll](https://github.com/LbhFront-end/About-ES6/blob/master/ES6-æ­£åˆ™çš„æ‰©å±•.md#stringprototypematchall)

------

## RegExpæ„é€ å‡½æ•°

åœ¨ES5ä¸­ï¼Œ`RegExp`æ„é€ å‡½æ•°çš„å‚æ•°æœ‰ä¸¤ç§æƒ…å†µ

åœ¨ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™æ˜¯ç¬¬äºŒä»½å‚æ•°è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ï¼ˆflagï¼‰

```javascript
var regex = new RegExp('xyz','i');
// ç­‰ä»·äº
var regex = /xyz/i;
```

ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™æ—¶ä¼šè¿”å›ä¸€ä¸ªåŸæœ‰æ­£åˆ™è¡¨è¾¾å¼çš„æ‹·è´

```javascript
var regex = new RegExp(/xyz/i/);
//ç­‰ä»·äº
var regex = /xyz/i;
```

ä½†æ˜¯ï¼ŒES5ä¸å…è®¸ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°æ·»åŠ ä¿®é¥°ç¬¦ï¼Œå¦åˆ™æŠ¥é”™

```javascript
var regex = new RegExp(/xyz/,'i');
// Uncaught TypeError: Cannot supply flags when constructing one RegExp from another
```

ES6 æ”¹å˜äº†è¿™ç§è¡Œä¸ºï¼Œå¦‚æœ`RegExp`æ„é€ å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ­£åˆ™å¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¿®é¥°ç¬¦ã€‚è€Œä¸”ï¼Œè¿”å›çš„æ­£åˆ™è¡¨è¾¾å¼ä¼šå¿½ç•¥åŸæœ‰çš„æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ï¼Œåªä½¿ç”¨æ–°æŒ‡å®šçš„ä¿®é¥°ç¬¦

```javascript
new RegExp(/abc/ig).flags
// i
```

ä¸Šé¢ä»£ç ä¸­ï¼ŒåŸæœ‰æ­£åˆ™å¯¹è±¡çš„ä¿®é¥°ç¬¦æ˜¯`ig`ï¼Œå®ƒä¼šè¢«ç¬¬äºŒä¸ªå‚æ•°`i`è¦†ç›–ã€‚ 

------

## å­—ç¬¦ä¸²çš„æ­£åˆ™æ–¹æ³•

å­—ç¬¦ä¸²å¯¹è±¡å…±æœ‰4ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼š `match()` `replace()` `search()` å’Œ`split()`

ES6å°†è¿™4ä¸ªæ–¹æ³•ï¼Œåœ¨è¯­è¨€å†…éƒ¨å…¨éƒ¨è°ƒç”¨`RegExp`çš„å®ä¾‹æ–¹æ³•ï¼Œä»è€Œåšåˆ°æ‰€æœ‰ä¸æ­£åˆ™ç›¸å…³çš„æ–¹æ³•ï¼Œå…¨éƒ½å®šä¹‰åœ¨`RegExp`å¯¹è±¡ä¸Š

- `String.prototype.match` è°ƒç”¨ `RegExp.prototype[Symbol.match]`
- `String.prototype.replace` è°ƒç”¨ `RegExp.prototype[Symbol.replace]`
- `String.prototype.search` è°ƒç”¨ `RegExp.prototype[Symbol.search]`
- `String.prototype.split` è°ƒç”¨ `RegExp.prototype[Symbol.split]`

------

## uä¿®é¥°ç¬¦

ES6 å¯¹æ­£åˆ™è¡¨è¾¾å¼æ·»åŠ äº†`u`ä¿®é¥°ç¬¦ï¼Œå«ä¹‰ä¸ºâ€œUnicode æ¨¡å¼â€ï¼Œç”¨æ¥æ­£ç¡®å¤„ç†å¤§äº`\uFFFF`çš„ Unicode å­—ç¬¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šæ­£ç¡®å¤„ç†å››ä¸ªå­—èŠ‚çš„ UTF-16 ç¼–ç ã€‚

```javascript
/^\uD83D/u.test('\uD83D\uDC2A') // false
/^\uD83D/.test('\uD83D\uDC2A') // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`\uD83D\uDC2A`æ˜¯ä¸€ä¸ªå››ä¸ªå­—èŠ‚çš„ UTF-16 ç¼–ç ï¼Œä»£è¡¨ä¸€ä¸ªå­—ç¬¦ã€‚ä½†æ˜¯ï¼ŒES5 ä¸æ”¯æŒå››ä¸ªå­—èŠ‚çš„ UTF-16 ç¼–ç ï¼Œä¼šå°†å…¶è¯†åˆ«ä¸ºä¸¤ä¸ªå­—ç¬¦ï¼Œå¯¼è‡´ç¬¬äºŒè¡Œä»£ç ç»“æœä¸º`true`ã€‚åŠ äº†`u`ä¿®é¥°ç¬¦ä»¥åï¼ŒES6 å°±ä¼šè¯†åˆ«å…¶ä¸ºä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç¬¬ä¸€è¡Œä»£ç ç»“æœä¸º`false`ã€‚

ä¸€æ—¦åŠ ä¸Š`u`ä¿®é¥°ç¬¦å·ï¼Œå°±ä¼šä¿®æ”¹ä¸‹é¢è¿™äº›æ­£åˆ™è¡¨è¾¾å¼çš„è¡Œä¸ºã€‚

**ï¼ˆ1ï¼‰ç‚¹å­—ç¬¦**

ç‚¹ï¼ˆ`.`ï¼‰å­—ç¬¦åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå«ä¹‰æ˜¯é™¤äº†æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦ã€‚å¯¹äºç ç‚¹å¤§äº`0xFFFF`çš„ Unicode å­—ç¬¦ï¼Œç‚¹å­—ç¬¦ä¸èƒ½è¯†åˆ«ï¼Œå¿…é¡»åŠ ä¸Š`u`ä¿®é¥°ç¬¦ã€‚

```javascript
var s = 'ğ ®·';

/^.$/.test(s) // false
/^.$/u.test(s) // true
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœä¸æ·»åŠ `u`ä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼å°±ä¼šè®¤ä¸ºå­—ç¬¦ä¸²ä¸ºä¸¤ä¸ªå­—ç¬¦ï¼Œä»è€ŒåŒ¹é…å¤±è´¥ã€‚

**ï¼ˆ2ï¼‰Unicode å­—ç¬¦è¡¨ç¤ºæ³•**

ES6 æ–°å¢äº†ä½¿ç”¨å¤§æ‹¬å·è¡¨ç¤º Unicode å­—ç¬¦ï¼Œè¿™ç§è¡¨ç¤ºæ³•åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­å¿…é¡»åŠ ä¸Š`u`ä¿®é¥°ç¬¦ï¼Œæ‰èƒ½è¯†åˆ«å½“ä¸­çš„å¤§æ‹¬å·ï¼Œå¦åˆ™ä¼šè¢«è§£è¯»ä¸ºé‡è¯ã€‚

```javascript
/\u{61}/.test('a') // false
/\u{61}/u.test('a') // true
/\u{20BB7}/u.test('ğ ®·') // true
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœä¸åŠ `u`ä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ— æ³•è¯†åˆ«`\u{61}`è¿™ç§è¡¨ç¤ºæ³•ï¼Œåªä¼šè®¤ä¸ºè¿™åŒ¹é… 61 ä¸ªè¿ç»­çš„`u`ã€‚

**ï¼ˆ3ï¼‰é‡è¯**

ä½¿ç”¨`u`ä¿®é¥°ç¬¦åï¼Œæ‰€æœ‰é‡è¯éƒ½ä¼šæ­£ç¡®è¯†åˆ«ç ç‚¹å¤§äº`0xFFFF`çš„ Unicode å­—ç¬¦ã€‚

```javascript
/a{2}/.test('aa') // true
/a{2}/u.test('aa') // true
/ğ ®·{2}/.test('ğ ®·ğ ®·') // false
/ğ ®·{2}/u.test('ğ ®·ğ ®·') // true
```

**ï¼ˆ4ï¼‰é¢„å®šä¹‰æ¨¡å¼**

`u`ä¿®é¥°ç¬¦ä¹Ÿå½±å“åˆ°é¢„å®šä¹‰æ¨¡å¼ï¼Œèƒ½å¦æ­£ç¡®è¯†åˆ«ç ç‚¹å¤§äº`0xFFFF`çš„ Unicode å­—ç¬¦ã€‚

```javascript
/^\S$/.test('ğ ®·') // false
/^\S$/u.test('ğ ®·') // true
```

ä¸Šé¢ä»£ç çš„`\S`æ˜¯é¢„å®šä¹‰æ¨¡å¼ï¼ŒåŒ¹é…æ‰€æœ‰éç©ºç™½å­—ç¬¦ã€‚åªæœ‰åŠ äº†`u`ä¿®é¥°ç¬¦ï¼Œå®ƒæ‰èƒ½æ­£ç¡®åŒ¹é…ç ç‚¹å¤§äº`0xFFFF`çš„ Unicode å­—ç¬¦ã€‚

åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå¯ä»¥å†™å‡ºä¸€ä¸ªæ­£ç¡®è¿”å›å­—ç¬¦ä¸²é•¿åº¦çš„å‡½æ•°ã€‚

```javascript
function codePointLength(text) {
  var result = text.match(/[\s\S]/gu);
  return result ? result.length : 0;
}

var s = 'ğ ®·ğ ®·';

s.length // 4
codePointLength(s) // 2
```

**ï¼ˆ5ï¼‰i ä¿®é¥°ç¬¦**

æœ‰äº› Unicode å­—ç¬¦çš„ç¼–ç ä¸åŒï¼Œä½†æ˜¯å­—å‹å¾ˆç›¸è¿‘ï¼Œæ¯”å¦‚ï¼Œ`\u004B`ä¸`\u212A`éƒ½æ˜¯å¤§å†™çš„`K`ã€‚

```javascript
/[a-z]/i.test('\u212A') // false
/[a-z]/iu.test('\u212A') // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œä¸åŠ `u`ä¿®é¥°ç¬¦ï¼Œå°±æ— æ³•è¯†åˆ«éè§„èŒƒçš„`K`å­—ç¬¦ã€‚

------

## RegExp.prototype.unicodeå±æ€§

æ­£åˆ™å®ä¾‹å¯¹è±¡æ–°å¢`unicode`å±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦è®¾ç½®äº†`u`ä¿®é¥°ç¬¦ã€‚

```javascript
const r1 = /hello/;
const r2 = /hello/u;

r1.unicode // false
r2.unicode // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦è®¾ç½®äº†`u`ä¿®é¥°ç¬¦ï¼Œå¯ä»¥ä»`unicode`å±æ€§çœ‹å‡ºæ¥ã€‚

------

## RegExp.prototype.stickyå±æ€§

ä¸`y`ä¿®é¥°ç¬¦ç›¸åŒ¹é…ï¼ŒES6çš„æ­£åˆ™å®ä¾‹å¯¹è±¡å¤šäº†`sticky`å±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦è®¾ç½®äº†`y`ä¿®é¥°ç¬¦

```javascript
var r = /hello\d/y;
r.sticky // true
```

------

## RegExp.prototype.flagså±æ€§

ES6ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ–°å¢äº†`flags`æ¨¡å¼ï¼Œä¼šè¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦

```javascript
// ES5 çš„ source å±æ€§
// è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„æ­£æ–‡
/abc/ig.source 
// "abc"

// ES6 çš„ flags å±æ€§
// è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦
/abc/ig.flags
// gi
```



------

## sä¿®é¥°ç¬¦:dotAllæ¨¡å¼

æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œç‚¹ï¼ˆ`.`ï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œä»£è¡¨ä»»æ„çš„å•ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªä¾‹å¤–ã€‚ä¸€ä¸ªæ˜¯å››ä¸ªå­—èŠ‚çš„UTF - 16å­—ç¬¦ï¼Œè¿™ä¸ªå¯ä»¥ç”¨`u`ä¿®é¥°ç¬¦è§£å†³ï¼›å¦å¤–ä¸€ä¸ªæ˜¯è¡Œç»ˆæ­¢ç¬¦ï¼ˆline terminator characterï¼‰

æ‰€è°“çš„è¡Œç»ˆæ­¢ç¬¦ï¼Œå°±æ˜¯è¯¥å­—ç¬¦è¡¨ç¤ºä¸€è¡Œçš„ç»ˆç»“ï¼Œä¸€ä¸‹å››ä¸ªå­—ç¬¦å±äºâ€œè¡Œç»ˆæ­¢ç¬¦â€

- -U + 000A æ¢è¡Œç¬¦ ï¼ˆ`\n`ï¼‰
- -U + 000D å›è½¦ç¬¦ ï¼ˆ`\r`ï¼‰
- -U + 2028 è¡Œåˆ†éš”ç¬¦ ï¼ˆline separatorï¼‰
- -U + 2029 æ®µåˆ†éš”ç¬¦ ï¼ˆparagraph separatorï¼‰

```javascript
/foo.bar/.test('foo\nbar')
// false
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå› ä¸º`.`ä¸åŒ¹é…`\n`ï¼Œæ‰€ä»¥æ­£åˆ™è¡¨è¾¾å¼è¿”å›`false`

ä½†æ˜¯å¾ˆå¤šä¼¼ä¹è¿˜æˆ‘ä»¬å¸Œæœ›åŒ¹é…çš„æ˜¯ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œè¿™æ—¶å°±æœ‰ä¸€ç§å˜é€šçš„å†™æ³•

```javascript
/foo[^]bar/.test('foo/nbar')
// true
```

è¿™ç§è§£å†³æ–¹æ³•æ¯•ç«Ÿä¸å¤ªç¬¦åˆç›´è§‰ï¼ŒES2018å¼•å…¥äº†`s`ä¿®é¥°ç¬¦ï¼Œä½¿å¾—`.`å¯ä»¥åŒ¹é…å•ä¸ªå­—ç¬¦

```javascript
/foo.bar/s.test('foo\nbar') // true
```

è¿™ä¸ªè¢«ç§°ä¸º`dotAll`æ¨¡å¼ï¼Œå³ç‚¹ï¼ˆdotï¼‰ä»£è¡¨ä¸€åˆ‡å­—ç¬¦ï¼Œæ‰€ä»¥ï¼Œæ­£åˆ™è¡¨è¾¾å¼è¿˜å¼•å…¥äº†ä¸€ä¸ª`dotAll`å±æ€§ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦å¤„åœ¨dotAll æ¨¡å¼

```javascript
const re = /foo.bar/s;
// å¦å¤–ä¸€ç§å†™æ³•
// const re = new RegExp('foo.bar'ï¼Œ's');

re.test('foo\nbar'); // true
re.dotAll() // true
re.flags // 's'
```

`s`ä¿®é¥°ç¬¦å’Œå¤šè¡Œä¿®é¥°ç¬¦`m`ä¸å†²çªï¼Œä¸¤è€…ä¸€èµ·ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œ`.`åŒ¹é…æ‰€æœ‰å­—ç¬¦ï¼Œè€Œ`^`å’Œ`$`åŒ¹é…æ¯ä¸€è¡Œçš„è¡Œé¦–å’Œè¡Œå°¾

------

## åè¡Œæ–­è¨€

JavaScript è¯­è¨€çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåªæ”¯æŒå…ˆè¡Œæ–­è¨€ï¼ˆlookaheadï¼‰å’Œå…ˆè¡Œå¦å®šæ–­è¨€ï¼ˆnegative lookaheadï¼‰ï¼Œä¸æ”¯æŒåè¡Œæ–­è¨€ï¼ˆlookbehindï¼‰å’Œåè¡Œå¦å®šæ–­è¨€ï¼ˆnegative lookbehindï¼‰ã€‚ES2018 å¼•å…¥äº†åè¡Œæ–­è¨€ã€‚

â€œå…ˆè¡Œæ–­è¨€â€æŒ‡çš„æ˜¯ï¼Œ`x`åªæœ‰åœ¨`y`å‰é¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ `/x(?=y)/`ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ç™¾åˆ†å·ä¹‹å‰çš„æ•°å­—ï¼Œè¦å†™æˆ`/\d+(?=%)/`ã€‚â€œå…ˆå¦å®šæ–­è¨€â€æŒ‡çš„æ˜¯ï¼Œ`x`åªæœ‰ä¸åœ¨`y`å‰é¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ`/x(?!y/`ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ä¸åœ¨ç™¾åˆ†å·ä¹‹å‰çš„æ•°å­—ï¼Œè¦å†™æˆ`/\d+(?!%)/`ã€‚ 

```javascript
/\d+(?=%)/.exec('100% of US presidents have been male')  // ["100"]
/\d+(?!%)/.exec('thatâ€™s all 44 of them')                 // ["44"]
```

```javascript
"]
/^(\d+)(\d+)$/.exec('1053') // ["1053", "105", "3"]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œéœ€è¦æ•æ‰ä¸¤ä¸ªç»„åŒ¹é…ã€‚æ²¡æœ‰â€œåè¡Œæ–­è¨€â€æ—¶ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·æ˜¯è´ªå©ªæ¨¡å¼ï¼Œç¬¬äºŒä¸ªæ‹¬å·åªèƒ½æ•è·ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç»“æœæ˜¯`105`å’Œ`3`ã€‚è€Œâ€œåè¡Œæ–­è¨€â€æ—¶ï¼Œç”±äºæ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦ï¼Œç¬¬äºŒä¸ªæ‹¬å·æ˜¯è´ªå©ªæ¨¡å¼ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·åªèƒ½æ•è·ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç»“æœæ˜¯`1`å’Œ`053`ã€‚

å…¶æ¬¡ï¼Œâ€œåè¡Œæ–­è¨€â€çš„åæ–œæ å¼•ç”¨ï¼Œä¹Ÿä¸é€šå¸¸çš„é¡ºåºç›¸åï¼Œå¿…é¡»æ”¾åœ¨å¯¹åº”çš„é‚£ä¸ªæ‹¬å·ä¹‹å‰ã€‚

```javascript
/(?<=(o)d\1)r/.exec('hodor')  // null
/(?<=\1d(o))r/.exec('hodor')  // ["r", "o"]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœåè¡Œæ–­è¨€çš„åæ–œæ å¼•ç”¨ï¼ˆ`\1`ï¼‰æ”¾åœ¨æ‹¬å·çš„åé¢ï¼Œå°±ä¸ä¼šå¾—åˆ°åŒ¹é…ç»“æœï¼Œå¿…é¡»æ”¾åœ¨å‰é¢æ‰å¯ä»¥ã€‚å› ä¸ºåè¡Œæ–­è¨€æ˜¯å…ˆä»å·¦åˆ°å³æ‰«æï¼Œå‘ç°åŒ¹é…ä»¥åå†å›è¿‡å¤´ï¼Œä»å³åˆ°å·¦å®Œæˆåæ–œæ å¼•ç”¨ã€‚

 

------

## Unicodeå±æ€§ç±»

ES2018Â [å¼•å…¥](https://github.com/tc39/proposal-regexp-unicode-property-escapes)äº†ä¸€ç§æ–°çš„ç±»çš„å†™æ³•`\p{...}`å’Œ`\P{...}`ï¼Œå…è®¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç¬¦åˆ Unicode æŸç§å±æ€§çš„æ‰€æœ‰å­—ç¬¦ã€‚ 

```javascript
const regexGreekSymbol = /\p{Script=Greek}/u;
regexGreekSymbol.test('Ï€') // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`\p{Script=Greek}`æŒ‡å®šåŒ¹é…ä¸€ä¸ªå¸Œè…Šæ–‡å­—æ¯ï¼Œæ‰€ä»¥åŒ¹é…`Ï€`æˆåŠŸã€‚

Unicode å±æ€§ç±»è¦æŒ‡å®šå±æ€§åå’Œå±æ€§å€¼ã€‚

```javascript
\p{UnicodePropertyName=UnicodePropertyValue}
```

å¯¹äºæŸäº›å±æ€§ï¼Œå¯ä»¥åªå†™å±æ€§åï¼Œæˆ–è€…åªå†™å±æ€§å€¼ã€‚

```javascript
\p{UnicodePropertyName}
\p{UnicodePropertyValue}
```

`\P{â€¦}`æ˜¯`\p{â€¦}`çš„åå‘åŒ¹é…ï¼Œå³åŒ¹é…ä¸æ»¡è¶³æ¡ä»¶çš„å­—ç¬¦ã€‚

æ³¨æ„ï¼Œè¿™ä¸¤ç§ç±»åªå¯¹ Unicode æœ‰æ•ˆï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦åŠ ä¸Š`u`ä¿®é¥°ç¬¦ã€‚å¦‚æœä¸åŠ `u`ä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨`\p`å’Œ`\P`ä¼šæŠ¥é”™ï¼ŒECMAScript é¢„ç•™äº†è¿™ä¸¤ä¸ªç±»ã€‚

ç”±äº Unicode çš„å„ç§å±æ€§éå¸¸å¤šï¼Œæ‰€ä»¥è¿™ç§æ–°çš„ç±»çš„è¡¨è¾¾èƒ½åŠ›éå¸¸å¼ºã€‚

```javascript
const regex = /^\p{Decimal_Number}+$/u;
regex.test('ğŸğŸğŸ‘ğŸœğŸğŸğŸ©ğŸªğŸ«ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸºğŸ»ğŸ¼') // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå±æ€§ç±»æŒ‡å®šåŒ¹é…æ‰€æœ‰åè¿›åˆ¶å­—ç¬¦ï¼Œå¯ä»¥çœ‹åˆ°å„ç§å­—å‹çš„åè¿›åˆ¶å­—ç¬¦éƒ½ä¼šåŒ¹é…æˆåŠŸã€‚

`\p{Number}`ç”šè‡³èƒ½åŒ¹é…ç½—é©¬æ•°å­—ã€‚

```javascript
// åŒ¹é…æ‰€æœ‰æ•°å­—
const regex = /^\p{Number}+$/u;
regex.test('Â²Â³Â¹Â¼Â½Â¾') // true
regex.test('ã‰›ã‰œã‰') // true
regex.test('â… â…¡â…¢â…£â…¤â…¥â…¦â…§â…¨â…©â…ªâ…«') // true
```

ä¸‹é¢æ˜¯å…¶ä»–ä¸€äº›ä¾‹å­ã€‚

```javascript
// åŒ¹é…æ‰€æœ‰ç©ºæ ¼
\p{White_Space}

// åŒ¹é…å„ç§æ–‡å­—çš„æ‰€æœ‰å­—æ¯ï¼Œç­‰åŒäº Unicode ç‰ˆçš„ \w
[\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]

// åŒ¹é…å„ç§æ–‡å­—çš„æ‰€æœ‰éå­—æ¯çš„å­—ç¬¦ï¼Œç­‰åŒäº Unicode ç‰ˆçš„ \W
[^\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]

// åŒ¹é… Emoji
/\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation}|\p{Emoji}\uFE0F/gu

// åŒ¹é…æ‰€æœ‰çš„ç®­å¤´å­—ç¬¦
const regexArrows = /^\p{Block=Arrows}+$/u;
regexArrows.test('â†â†‘â†’â†“â†”â†•â†–â†—â†˜â†™â‡â‡â‡‘â‡’â‡“â‡”â‡•â‡–â‡—â‡˜â‡™â‡§â‡©') // true
```

------

## å…·åç»„åŒ¹é…

### ç®€ä»‹

æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨åœ†æ‹¬å·è¿›è¡Œç»„åŒ¹é…ã€‚

```javascript
const RE_DATE = /(\d{4})-(\d{2})-(\d{2})/;
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼é‡Œé¢æœ‰ä¸‰ç»„åœ†æ‹¬å·ã€‚ä½¿ç”¨`exec`æ–¹æ³•ï¼Œå°±å¯ä»¥å°†è¿™ä¸‰ç»„åŒ¹é…ç»“æœæå–å‡ºæ¥ã€‚

```javascript
const RE_DATE = /(\d{4})-(\d{2})-(\d{2})/;

const matchObj = RE_DATE.exec('1999-12-31');
const year = matchObj[1]; // 1999
const month = matchObj[2]; // 12
const day = matchObj[3]; // 31
```

ç»„åŒ¹é…çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæ¯ä¸€ç»„çš„åŒ¹é…å«ä¹‰ä¸å®¹æ˜“çœ‹å‡ºæ¥ï¼Œè€Œä¸”åªèƒ½ç”¨æ•°å­—åºå·ï¼ˆæ¯”å¦‚`matchObj[1]`ï¼‰å¼•ç”¨ï¼Œè¦æ˜¯ç»„çš„é¡ºåºå˜äº†ï¼Œå¼•ç”¨çš„æ—¶å€™å°±å¿…é¡»ä¿®æ”¹åºå·ã€‚

ES2018 å¼•å…¥äº†[å…·åç»„åŒ¹é…](https://github.com/tc39/proposal-regexp-named-groups)ï¼ˆNamed Capture Groupsï¼‰ï¼Œå…è®¸ä¸ºæ¯ä¸€ä¸ªç»„åŒ¹é…æŒ‡å®šä¸€ä¸ªåå­—ï¼Œæ—¢ä¾¿äºé˜…è¯»ä»£ç ï¼Œåˆä¾¿äºå¼•ç”¨ã€‚

```javascript
const RE_DATE = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/;

const matchObj = RE_DATE.exec('1999-12-31');
const year = matchObj.groups.year; // 1999
const month = matchObj.groups.month; // 12
const day = matchObj.groups.day; // 31
```

ä¸Šé¢ä»£ç ä¸­ï¼Œâ€œå…·åç»„åŒ¹é…â€åœ¨åœ†æ‹¬å·å†…éƒ¨ï¼Œæ¨¡å¼çš„å¤´éƒ¨æ·»åŠ â€œé—®å· + å°–æ‹¬å· + ç»„åâ€ï¼ˆ`?<year>`ï¼‰ï¼Œç„¶åå°±å¯ä»¥åœ¨`exec`æ–¹æ³•è¿”å›ç»“æœçš„`groups`å±æ€§ä¸Šå¼•ç”¨è¯¥ç»„åã€‚åŒæ—¶ï¼Œæ•°å­—åºå·ï¼ˆ`matchObj[1]`ï¼‰ä¾ç„¶æœ‰æ•ˆã€‚

å…·åç»„åŒ¹é…ç­‰äºä¸ºæ¯ä¸€ç»„åŒ¹é…åŠ ä¸Šäº† IDï¼Œä¾¿äºæè¿°åŒ¹é…çš„ç›®çš„ã€‚å¦‚æœç»„çš„é¡ºåºå˜äº†ï¼Œä¹Ÿä¸ç”¨æ”¹å˜åŒ¹é…åçš„å¤„ç†ä»£ç ã€‚

å¦‚æœå…·åç»„æ²¡æœ‰åŒ¹é…ï¼Œé‚£ä¹ˆå¯¹åº”çš„`groups`å¯¹è±¡å±æ€§ä¼šæ˜¯`undefined`ã€‚

```javascript
const RE_OPT_A = /^(?<as>a+)?$/;
const matchObj = RE_OPT_A.exec('');

matchObj.groups.as // undefined
'as' in matchObj.groups // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå…·åç»„`as`æ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼Œé‚£ä¹ˆ`matchObj.groups.as`å±æ€§å€¼å°±æ˜¯`undefined`ï¼Œå¹¶ä¸”`as`è¿™ä¸ªé”®ååœ¨`groups`æ˜¯å§‹ç»ˆå­˜åœ¨çš„ã€‚

### è§£æ„èµ‹å€¼å’Œæ›¿æ¢

æœ‰äº†å…·åç»„åŒ¹é…ä»¥åï¼Œå¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼ç›´æ¥ä»åŒ¹é…ç»“æœä¸Šä¸ºå˜é‡èµ‹å€¼ã€‚

```javascript
let {groups: {one, two}} = /^(?<one>.*):(?<two>.*)$/u.exec('foo:bar');
one  // foo
two  // bar
```

å­—ç¬¦ä¸²æ›¿æ¢æ—¶ï¼Œä½¿ç”¨`$<ç»„å>`å¼•ç”¨å…·åç»„ã€‚

```javascript
let re = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/u;

'2015-01-02'.replace(re, '$<day>/$<month>/$<year>')
// '02/01/2015'
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`replace`æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚

`replace`æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å‚æ•°åºåˆ—å¦‚ä¸‹ã€‚

```javascript
'2015-01-02'.replace(re, (
   matched, // æ•´ä¸ªåŒ¹é…ç»“æœ 2015-01-02
   capture1, // ç¬¬ä¸€ä¸ªç»„åŒ¹é… 2015
   capture2, // ç¬¬äºŒä¸ªç»„åŒ¹é… 01
   capture3, // ç¬¬ä¸‰ä¸ªç»„åŒ¹é… 02
   position, // åŒ¹é…å¼€å§‹çš„ä½ç½® 0
   S, // åŸå­—ç¬¦ä¸² 2015-01-02
   groups // å…·åç»„æ„æˆçš„ä¸€ä¸ªå¯¹è±¡ {year, month, day}
 ) => {
 let {day, month, year} = args[args.length - 1];
 return `${day}/${month}/${year}`;
});
```

å…·åç»„åŒ¹é…åœ¨åŸæ¥çš„åŸºç¡€ä¸Šï¼Œæ–°å¢äº†æœ€åä¸€ä¸ªå‡½æ•°å‚æ•°ï¼šå…·åç»„æ„æˆçš„ä¸€ä¸ªå¯¹è±¡ã€‚å‡½æ•°å†…éƒ¨å¯ä»¥ç›´æ¥å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œè§£æ„èµ‹å€¼ã€‚

### å¼•ç”¨

å¦‚æœè¦åœ¨æ­£åˆ™è¡¨è¾¾å¼å†…éƒ¨å¼•ç”¨æŸä¸ªâ€œå…·åç»„åŒ¹é…â€ï¼Œå¯ä»¥ä½¿ç”¨`\k<ç»„å>`çš„å†™æ³•ã€‚

```javascript
const RE_TWICE = /^(?<word>[a-z]+)!\k<word>$/;
RE_TWICE.test('abc!abc') // true
RE_TWICE.test('abc!ab') // false
```

æ•°å­—å¼•ç”¨ï¼ˆ`\1`ï¼‰ä¾ç„¶æœ‰æ•ˆã€‚

```javascript
const RE_TWICE = /^(?<word>[a-z]+)!\1$/;
RE_TWICE.test('abc!abc') // true
RE_TWICE.test('abc!ab') // false
```

è¿™ä¸¤ç§å¼•ç”¨è¯­æ³•è¿˜å¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚

```javascript
const RE_TWICE = /^(?<word>[a-z]+)!\k<word>!\1$/;
RE_TWICE.test('abc!abc!abc') // true
RE_TWICE.test('abc!abc!ab') // false
```

------

## String.prototype.matchAll

å¦‚æœä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åœ¨å­—ç¬¦ä¸²é‡Œé¢æœ‰å¤šä¸ªåŒ¹é…ï¼Œç°åœ¨ä¸€èˆ¬ä½¿ç”¨`g`ä¿®é¥°ç¬¦æˆ–`y`ä¿®é¥°ç¬¦ï¼Œåœ¨å¾ªç¯é‡Œé¢é€ä¸€å–å‡ºã€‚

```javascript
var regex = /t(e)(st(\d?))/g;
var string = 'test1test2test3';

var matches = [];
var match;
while (match = regex.exec(string)) {
  matches.push(match);
}

matches
// [
//   ["test1", "e", "st1", "1", index: 0, input: "test1test2test3"],
//   ["test2", "e", "st2", "2", index: 5, input: "test1test2test3"],
//   ["test3", "e", "st3", "3", index: 10, input: "test1test2test3"]
// ]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`while`å¾ªç¯å–å‡ºæ¯ä¸€è½®çš„æ­£åˆ™åŒ¹é…ï¼Œä¸€å…±ä¸‰è½®ã€‚

ç›®å‰æœ‰ä¸€ä¸ª[ææ¡ˆ](https://github.com/tc39/proposal-string-matchall)ï¼Œå¢åŠ äº†`String.prototype.matchAll`æ–¹æ³•ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å–å‡ºæ‰€æœ‰åŒ¹é…ã€‚ä¸è¿‡ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªéå†å™¨ï¼ˆIteratorï¼‰ï¼Œè€Œä¸æ˜¯æ•°ç»„ã€‚

```javascript
const string = 'test1test2test3';

// g ä¿®é¥°ç¬¦åŠ ä¸åŠ éƒ½å¯ä»¥
const regex = /t(e)(st(\d?))/g;

for (const match of string.matchAll(regex)) {
  console.log(match);
}
// ["test1", "e", "st1", "1", index: 0, input: "test1test2test3"]
// ["test2", "e", "st2", "2", index: 5, input: "test1test2test3"]
// ["test3", "e", "st3", "3", index: 10, input: "test1test2test3"]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äº`string.matchAll(regex)`è¿”å›çš„æ˜¯éå†å™¨ï¼Œæ‰€ä»¥å¯ä»¥ç”¨`for...of`å¾ªç¯å–å‡ºã€‚ç›¸å¯¹äºè¿”å›æ•°ç»„ï¼Œè¿”å›éå†å™¨çš„å¥½å¤„åœ¨äºï¼Œå¦‚æœåŒ¹é…ç»“æœæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ç»„ï¼Œé‚£ä¹ˆéå†å™¨æ¯”è¾ƒèŠ‚çœèµ„æºã€‚

éå†å™¨è½¬ä¸ºæ•°ç»„æ˜¯éå¸¸ç®€å•çš„ï¼Œä½¿ç”¨`...`è¿ç®—ç¬¦å’Œ`Array.from`æ–¹æ³•å°±å¯ä»¥äº†ã€‚

```javascript
// è½¬ä¸ºæ•°ç»„æ–¹æ³•ä¸€
[...string.matchAll(regex)]

// è½¬ä¸ºæ•°ç»„æ–¹æ³•äºŒ
Array.from(string.matchAll(regex));
```
